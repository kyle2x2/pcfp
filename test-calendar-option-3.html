<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule v1.3 - Calendar Option 3: Hybrid Calendar</title>
    
    <!-- PCFP Design System -->
    <style>
        :root {
            --pcfp-white: #ffffff;
            --pcfp-gold: #C6A247;
            --pcfp-panel: #f8fafc;
            --pcfp-border: #e5e7eb;
            --pcfp-text: #0f172a;
            --pcfp-text-muted: #64748b;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            background: var(--pcfp-white);
            color: var(--pcfp-text);
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--pcfp-white);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .test-header {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
            padding: 20px;
            text-align: center;
        }
        
        .test-content {
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--pcfp-border);
            border-radius: 8px;
            background: var(--pcfp-panel);
        }
        
        .test-section h3 {
            color: var(--pcfp-gold);
            margin-top: 0;
        }
        
        /* Task Form */
        .task-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--pcfp-text);
        }
        
        .form-group input, .form-group select {
            padding: 8px 12px;
            border: 1px solid var(--pcfp-border);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .btn {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn:hover {
            background: #a88a3a;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .view-toggle button {
            padding: 8px 16px;
            border: 1px solid var(--pcfp-border);
            background: var(--pcfp-white);
            border-radius: 6px;
            cursor: pointer;
        }
        
        .view-toggle button.active {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
            border-color: var(--pcfp-gold);
        }
        
        /* Hybrid Calendar Styles */
        .hybrid-container {
            border: 1px solid var(--pcfp-border);
            border-radius: 8px;
            overflow: hidden;
            background: var(--pcfp-white);
        }
        
        .hybrid-header {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .hybrid-nav {
            display: flex;
            gap: 10px;
        }
        
        .hybrid-nav button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--pcfp-white);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .hybrid-nav button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Month View */
        .month-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .month-day-header {
            background: var(--pcfp-panel);
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
        }
        
        .month-day {
            min-height: 120px;
            padding: 8px;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
            position: relative;
            cursor: pointer;
        }
        
        .month-day:hover {
            background: var(--pcfp-panel);
        }
        
        .month-day.today {
            background: #fef3c7;
        }
        
        .month-day.other-month {
            background: #f8fafc;
            color: var(--pcfp-text-muted);
        }
        
        /* Week View */
        .week-view {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
        }
        
        .week-time-header {
            background: var(--pcfp-panel);
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
        }
        
        .week-day-header {
            background: var(--pcfp-panel);
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
        }
        
        .week-time-slot {
            padding: 8px;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
            font-size: 12px;
            color: var(--pcfp-text-muted);
            text-align: center;
        }
        
        .week-day-slot {
            min-height: 60px;
            padding: 8px;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
            position: relative;
            cursor: pointer;
        }
        
        .week-day-slot:hover {
            background: var(--pcfp-panel);
        }
        
        .week-day-slot.today {
            background: #fef3c7;
        }
        
        /* Day View */
        .day-view {
            display: grid;
            grid-template-columns: 100px 1fr;
        }
        
        .day-time-slot {
            padding: 15px 10px;
            border-bottom: 1px solid var(--pcfp-border);
            border-right: 1px solid var(--pcfp-border);
            font-size: 12px;
            color: var(--pcfp-text-muted);
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .day-content-slot {
            padding: 15px 10px;
            border-bottom: 1px solid var(--pcfp-border);
            position: relative;
            min-height: 60px;
            cursor: pointer;
        }
        
        .day-content-slot:hover {
            background: var(--pcfp-panel);
        }
        
        .day-content-slot.today {
            background: #fef3c7;
        }
        
        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .task-item {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
            padding: 2px 6px;
            margin: 1px 0;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .task-item.completed {
            background: #f4e4b7;
            color: #92400e;
        }
        
        .task-item.in-progress {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
        }
        
        .task-item.not-started {
            background: #faf6e9;
            color: #92400e;
        }
        
        .task-item.critical {
            border: 2px solid #dc2626;
        }
        
        .task-block {
            position: absolute;
            left: 5px;
            right: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            z-index: 10;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .task-block.completed {
            background: #f4e4b7;
            color: #92400e;
            border: 1px solid #fbbf24;
        }
        
        .task-block.in-progress {
            background: var(--pcfp-gold);
            color: var(--pcfp-white);
            border: 1px solid #a88a3a;
        }
        
        .task-block.not-started {
            background: #faf6e9;
            color: #92400e;
            border: 1px solid #fbbf24;
        }
        
        .task-block.critical {
            border: 2px solid #dc2626;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-completed { background: #f4e4b7; color: #92400e; }
        .status-in-progress { background: var(--pcfp-gold); color: var(--pcfp-white); }
        .status-not-started { background: #faf6e9; color: #92400e; }
        
        .priority-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .priority-low { background: #dcfce7; color: #166534; }
        .priority-medium { background: #fef3c7; color: #92400e; }
        .priority-high { background: #fecaca; color: #991b1b; }
        .priority-critical { background: #fef2f2; color: #dc2626; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Schedule v1.3 - Calendar Option 3: Hybrid Calendar</h1>
            <p>Month, Week, and Day views with task creation functionality</p>
        </div>
        
        <div class="test-content">
            <!-- Task Form Section -->
            <div class="test-section">
                <h3>Create New Task</h3>
                <form id="taskForm" class="task-form">
                    <div class="form-group">
                        <label for="taskTitle">Task Title</label>
                        <input type="text" id="taskTitle" placeholder="Enter task title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="duration">Duration (Days)</label>
                        <input type="number" id="duration" min="1" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="assignee">Assignee</label>
                        <input type="text" id="assignee" placeholder="Enter assignee">
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status">
                            <option value="not-started">Not Started</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="priority">Priority</label>
                        <select id="priority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="phase">Phase</label>
                        <select id="phase">
                            <option value="Pre-Construction">Pre-Construction</option>
                            <option value="Foundation">Foundation</option>
                            <option value="Framing">Framing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Finishing">Finishing</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn">Add Task</button>
                    </div>
                </form>
            </div>
            
            <!-- View Toggle -->
            <div class="test-section">
                <h3>Calendar View</h3>
                <div class="view-toggle">
                    <button id="monthView" class="active">Month View</button>
                    <button id="weekView">Week View</button>
                    <button id="dayView">Day View</button>
                </div>
                
                <div id="calendar" class="hybrid-container"></div>
            </div>
            
            <!-- Task List Section -->
            <div class="test-section">
                <h3>Current Tasks</h3>
                <div id="taskList"></div>
            </div>
        </div>
    </div>

    <script>
        // Sample task data with duration field
        let tasks = [
            {
                id: 'task_001',
                title: 'Site Preparation',
                description: 'Clear site and prepare for construction',
                startDate: '2024-01-15',
                endDate: '2024-01-20',
                duration: 6,
                status: 'completed',
                priority: 'high',
                assignee: 'John Smith',
                progress: 100,
                phase: 'Pre-Construction'
            },
            {
                id: 'task_002',
                title: 'Foundation Work',
                description: 'Pour concrete foundation',
                startDate: '2024-01-21',
                endDate: '2024-01-30',
                duration: 10,
                status: 'in-progress',
                priority: 'critical',
                assignee: 'Mike Johnson',
                progress: 60,
                phase: 'Foundation'
            },
            {
                id: 'task_003',
                title: 'Framing',
                description: 'Install structural framing',
                startDate: '2024-02-01',
                endDate: '2024-02-15',
                duration: 15,
                status: 'not-started',
                priority: 'high',
                assignee: 'Tom Wilson',
                progress: 0,
                phase: 'Framing'
            }
        ];

        let currentDate = new Date();
        let currentView = 'month';

        // Initialize calendar
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
            renderTaskList();
            setupEventListeners();
        });

        function setupEventListeners() {
            // View toggle
            document.getElementById('monthView').addEventListener('click', () => setView('month'));
            document.getElementById('weekView').addEventListener('click', () => setView('week'));
            document.getElementById('dayView').addEventListener('click', () => setView('day'));

            // Form events
            document.getElementById('startDate').addEventListener('change', calculateEndDate);
            document.getElementById('duration').addEventListener('change', calculateEndDate);
            document.getElementById('endDate').addEventListener('change', calculateDuration);

            // Form submission
            document.getElementById('taskForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewTask();
            });
        }

        function setView(view) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-toggle button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(view + 'View').classList.add('active');
            
            renderCalendar();
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            
            if (currentView === 'week') {
                renderWeekView(calendar);
            } else if (currentView === 'day') {
                renderDayView(calendar);
            } else {
                renderMonthView(calendar);
            }
        }

        function renderMonthView(container) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const endDate = new Date(lastDay);
            endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));
            
            const header = `
                <div class="hybrid-header">
                    <h2>${new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</h2>
                    <div class="hybrid-nav">
                        <button onclick="previousMonth()">‹</button>
                        <button onclick="today()">Today</button>
                        <button onclick="nextMonth()">›</button>
                    </div>
                </div>
            `;
            
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                .map(day => `<div class="month-day-header">${day}</div>`)
                .join('');
            
            const days = [];
            const current = new Date(startDate);
            
            while (current <= endDate) {
                const isToday = current.toDateString() === new Date().toDateString();
                const isOtherMonth = current.getMonth() !== month;
                const dayTasks = getTasksForDate(current);
                
                const dayClass = `month-day${isToday ? ' today' : ''}${isOtherMonth ? ' other-month' : ''}`;
                
                const taskElements = dayTasks.map(task => 
                    `<div class="task-item ${task.status} ${task.priority === 'critical' ? 'critical' : ''}" 
                         onclick="showTaskDetails('${task.id}')" 
                         title="${task.title} - ${task.duration} days - ${task.assignee}">
                         ${task.title}
                    </div>`
                ).join('');
                
                days.push(`
                    <div class="${dayClass}" onclick="selectDate('${current.toISOString().split('T')[0]}')">
                        <div class="day-number">${current.getDate()}</div>
                        ${taskElements}
                    </div>
                `);
                
                current.setDate(current.getDate() + 1);
            }
            
            container.innerHTML = header + '<div class="month-view">' + dayHeaders + days.join('') + '</div>';
        }

        function renderWeekView(container) {
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
            
            const header = `
                <div class="hybrid-header">
                    <h2>Week of ${startOfWeek.toLocaleDateString()}</h2>
                    <div class="hybrid-nav">
                        <button onclick="previousWeek()">‹</button>
                        <button onclick="today()">Today</button>
                        <button onclick="nextWeek()">›</button>
                    </div>
                </div>
            `;
            
            const timeSlots = ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const dayHeaders = ['Time', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                .map(day => `<div class="week-day-header">${day}</div>`)
                .join('');
            
            const timeRows = [];
            
            for (let timeSlot of timeSlots) {
                const row = [];
                row.push(`<div class="week-time-slot">${timeSlot}</div>`);
                
                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startOfWeek);
                    currentDate.setDate(startOfWeek.getDate() + i);
                    const isToday = currentDate.toDateString() === new Date().toDateString();
                    
                    const dayTasks = getTasksForDateAndTime(currentDate, timeSlot);
                    const dayClass = `week-day-slot${isToday ? ' today' : ''}`;
                    
                    const taskElements = dayTasks.map(task => 
                        `<div class="task-block ${task.status} ${task.priority === 'critical' ? 'critical' : ''}" 
                             onclick="showTaskDetails('${task.id}')" 
                             title="${task.title} - ${task.duration} days - ${task.assignee}">
                             ${task.title}
                        </div>`
                    ).join('');
                    
                    row.push(`<div class="${dayClass}">${taskElements}</div>`);
                }
                
                timeRows.push(row.join(''));
            }
            
            container.innerHTML = header + '<div class="week-view">' + dayHeaders + timeRows.join('') + '</div>';
        }

        function renderDayView(container) {
            const header = `
                <div class="hybrid-header">
                    <h2>${currentDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h2>
                    <div class="hybrid-nav">
                        <button onclick="previousDay()">‹</button>
                        <button onclick="today()">Today</button>
                        <button onclick="nextDay()">›</button>
                    </div>
                </div>
            `;
            
            const timeSlots = ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const timeRows = [];
            
            for (let timeSlot of timeSlots) {
                const dayTasks = getTasksForDateAndTime(currentDate, timeSlot);
                
                const taskElements = dayTasks.map(task => 
                    `<div class="task-block ${task.status} ${task.priority === 'critical' ? 'critical' : ''}" 
                         onclick="showTaskDetails('${task.id}')" 
                         title="${task.title} - ${task.duration} days - ${task.assignee}">
                         ${task.title}
                    </div>`
                ).join('');
                
                timeRows.push(`
                    <div class="day-time-slot">${timeSlot}</div>
                    <div class="day-content-slot">${taskElements}</div>
                `);
            }
            
            container.innerHTML = header + '<div class="day-view">' + timeRows.join('') + '</div>';
        }

        function getTasksForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            return tasks.filter(task => {
                const start = new Date(task.startDate);
                const end = new Date(task.endDate);
                const check = new Date(dateStr);
                return check >= start && check <= end;
            });
        }

        function getTasksForDateAndTime(date, timeSlot) {
            const dateStr = date.toISOString().split('T')[0];
            return tasks.filter(task => {
                const start = new Date(task.startDate);
                const end = new Date(task.endDate);
                const check = new Date(dateStr);
                return check >= start && check <= end;
            });
        }

        function selectDate(dateStr) {
            document.getElementById('startDate').value = dateStr;
            calculateEndDate();
        }

        function showTaskDetails(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                alert(`Task: ${task.title}\nDuration: ${task.duration} days\nAssignee: ${task.assignee}\nStatus: ${task.status}\nPriority: ${task.priority}\nProgress: ${task.progress}%`);
            }
        }

        // Duration calculation functions
        function calculateEndDate() {
            const startDate = document.getElementById('startDate').value;
            const duration = parseInt(document.getElementById('duration').value);
            
            if (startDate && duration) {
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + duration - 1);
                document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            }
        }

        function calculateDuration() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                document.getElementById('duration').value = diffDays;
            }
        }

        function addNewTask() {
            const newTask = {
                id: 'task_' + Date.now(),
                title: document.getElementById('taskTitle').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                duration: parseInt(document.getElementById('duration').value),
                status: document.getElementById('status').value,
                priority: document.getElementById('priority').value,
                assignee: document.getElementById('assignee').value,
                phase: document.getElementById('phase').value,
                progress: 0
            };
            
            tasks.push(newTask);
            renderCalendar();
            renderTaskList();
            document.getElementById('taskForm').reset();
            document.getElementById('endDate').value = '';
        }

        // Navigation functions
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function previousWeek() {
            currentDate.setDate(currentDate.getDate() - 7);
            renderCalendar();
        }

        function nextWeek() {
            currentDate.setDate(currentDate.getDate() + 7);
            renderCalendar();
        }

        function previousDay() {
            currentDate.setDate(currentDate.getDate() - 1);
            renderCalendar();
        }

        function nextDay() {
            currentDate.setDate(currentDate.getDate() + 1);
            renderCalendar();
        }

        function today() {
            currentDate = new Date();
            renderCalendar();
        }

        function renderTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = tasks.map(task => `
                <div style="border: 1px solid var(--pcfp-border); padding: 15px; margin-bottom: 10px; border-radius: 6px; background: var(--pcfp-white);">
                    <h4>${task.title}</h4>
                    <p><strong>Duration:</strong> ${task.duration} days (${task.startDate} to ${task.endDate})</p>
                    <p><strong>Assignee:</strong> ${task.assignee}</p>
                    <p><strong>Phase:</strong> ${task.phase}</p>
                    <span class="status-badge status-${task.status}">${task.status}</span>
                    <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
